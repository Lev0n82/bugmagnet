(()=>{var e={259:e=>{e.exports=function(e){"use strict";const t=this;t.saveOptions=function(t){return new Promise((n,o)=>{e.storage.sync.get(null,r=>{const s=Object.assign({},r,t);e.storage.sync.set(s,()=>{e.runtime.lastError?o(e.runtime.lastError):n()})})})},t.getOptionsAsync=function(){return new Promise(t=>{e.storage.sync.get(null,t)})},t.openSettings=function(){e.runtime.openOptionsPage&&e.runtime.openOptionsPage()},t.openUrl=function(t){e.tabs&&e.tabs.create&&e.tabs.create({url:t})},t.addStorageListener=function(t){e.storage.onChanged.addListener(function(e,n){"sync"===n&&t(e)})},t.getRemoteFile=function(e){return fetch(e,{mode:"cors"}).then(function(e){if(e.ok)return e.text();throw new Error("Network error reading the remote URL")})},t.closeWindow=function(){},t.readFile=function(e){return new Promise((t,n)=>{const o=new FileReader;o.onload=function(e){try{t(e.target.result)}catch(e){n(e)}},o.onerror=n,o.readAsText(e,"UTF-8")})},t.executeScript=function(t,n){return new Promise(o=>e.tabs.executeScript(t,{file:n},o))},t.sendMessage=function(t,n){return e.tabs.sendMessage(t,n)},t.requestPermissions=function(t){return new Promise((n,o)=>{try{e.permissions.request({permissions:t},function(e){e?n():o()})}catch(e){console.log(e),o(e)}})},t.removePermissions=function(t){return new Promise(n=>e.permissions.remove({permissions:t},n))},t.copyToClipboard=function(e){const t=function(t){t.clipboardData.setData("text/plain",e),t.preventDefault()};document.addEventListener("copy",t),document.execCommand("copy"),document.removeEventListener("copy",t)},t.showMessage=function(t){e.tabs.executeScript(null,{code:`alert("${t}")`})},t.createContextMenu=function(t){return t&&t.id&&(t.id=String(t.id)),e.contextMenus.create(t)}}},288:e=>{e.exports=function(e,t){"use strict";let n,o,r,s,c=[];const i=function(t){const n=e.querySelector("[role=status]");n.textContent=t,setTimeout(function(){n.textContent=""},1500)},a=function(){return t.saveOptions({additionalMenus:c,skipStandard:r,debugLogging:s}).catch(i)},l=function(){o.innerHTML="",c&&c.length?(c.forEach(function(e,t){const r=n.cloneNode(!0);o.appendChild(r),r.querySelector("[role=name]").textContent=e.name,e.remote?function(e,t){const n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("target","_blank"),n.textContent=t.replace(/.*\//g,""),e.appendChild(n)}(r.querySelector("[role=source]"),e.source):r.querySelector("[role=source]").textContent=e.source||"",r.querySelector("[role=remove]").addEventListener("click",function(){c.splice(t,1),l(),a()})}),e.querySelector("[role=no-custom]").style.display="none",e.querySelector("[role=yes-custom]").style.display=""):(e.querySelector("[role=yes-custom]").style.display="none",e.querySelector("[role=no-custom]").style.display=""),e.querySelector("[role=option-skipStandard]").checked=!!r,e.querySelector("[role=option-debugLogging]").checked=!!s},u=function(){e.querySelector("[role=main-screen]").style.display="",e.querySelector("[role=file-loader]").style.display="none"},d=function(e,t){const n=JSON.parse(e);c.push(Object.assign({},t,{config:n})),u(),l(),a()},g=function(){const t=e.querySelector("[role=submenu-name]"),n=e.querySelector("[role=custom-config-text]");t.value="",n.value="",e.querySelector("[role=main-screen]").style.display="none",e.querySelector("[role=file-loader]").style.display=""};return function(){const h=e.querySelector("[role=submenu-name]"),p=e.querySelector("[role=option-skipStandard]"),y=e.querySelector("[role=option-debugLogging]");return Array.from(e.querySelectorAll("form")).map(e=>e.addEventListener("submit",e=>e.preventDefault())),e.querySelector("[role=close]").addEventListener("click",t.closeWindow),e.querySelector("[role=add]").addEventListener("click",g),Array.from(e.querySelectorAll("[role=back]")).map(e=>e.addEventListener("click",u)),e.querySelector("[role=select-file-cover]").addEventListener("click",()=>{const t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});e.querySelector("[role=file-selector]").dispatchEvent(t)}),p.addEventListener("change",function(){r=!!p.checked,a()}),y.addEventListener("change",function(){s=!!y.checked,a()}),e.querySelector("[role=file-selector]").addEventListener("change",function(){const e=this.files[0],n=e.name,o=h.value&&h.value.trim();o?t.readFile(e).then(e=>{d(e,{name:o,source:n})}).catch(i):(i("Please provide submenu name!"),h.value=""),this.value=""}),e.querySelector("[role=add-custom-config]").addEventListener("click",()=>{const t=h.value&&h.value.trim(),n=e.querySelector("[role=custom-config-text]").value;if(!t)return h.value="",i("Please provide submenu name!");if(!n)return i("Please provide the configuration");try{d(n,{name:t})}catch(e){i(e)}}),e.querySelector("[role=add-remote-config]").addEventListener("click",()=>{const n=h.value&&h.value.trim(),o=e.querySelector('[role="remote-config-url"]'),r=o.value;if(n){if(!r)return i("Please provide the url");t.getRemoteFile(r).then(e=>{i("got file"),d(e,{name:n,source:r,remote:!0}),h.value="",o.value=""}).catch(i)}else i("Please provide submenu name!"),h.value=""}),n=e.querySelector("[role=template]"),o=n.parentElement,o.removeChild(n),u(),t.getOptionsAsync().then(function(e){c=e&&Array.isArray(e.additionalMenus)?e.additionalMenus:[],r=e&&e.skipStandard,s=e&&e.debugLogging,l()})}()}},329:(e,t,n)=>{const o=n(345);e.exports=class{constructor(e){this.browserInterface=e,this.options={},this.client=null,this.cache=new Map}async loadOptions(){this.options=await this.browserInterface.getOptionsAsync()||{};const e=this.options.clientId||"d81f3ba2-ebf7-4d4c-8550-e642c3736d99",t=this.options.vaultUrl,n=this.options.clientSecret||"",r=this.options.tenantId||"",s=this.options.scope||"https://vault.azure.net/.default";this.client=new o(e,t,n,r,s)}fromSecretName(e){return e.replace(/---/g,"_").replace(/--/g,"@").replace(/-/g,".")}async getSecret(e){await this.loadOptions();const t=Date.now();if(this.cache.has(e)&&t-this.cache.get(e).ts<3e5)return this.cache.get(e).value;const n=await this.client.getSecret(e);return this.cache.set(e,{value:n,ts:t}),n}async listAndGroupSecrets(){await this.loadOptions();const e=await this.client.listSecrets(),t=this.options.groupingRules||[],n={Ungrouped:[]},o=Date.now(),r=e.map(async e=>{const r=this.fromSecretName(e.name),s=await this.client.getSecret(r);this.cache.set(r,{value:s,ts:o});let c=!1;t.forEach(e=>{new RegExp(e.pattern).test(r)&&(n[e.name]||(n[e.name]=[]),n[e.name].push(r),c=!0)}),c||n.Ungrouped.push(r)});return await Promise.all(r),n}async fillCredentials(e,t){const n=await this.getSecret(t);await this.browserInterface.executeScript(e,"/credential-fill.js"),await this.browserInterface.sendMessage(e,{username:t,password:n})}async updatePassword(e,t){await this.loadOptions(),await this.client.setSecret(e,t),this.cache.delete(e)}}},345:e=>{e.exports=class{constructor(e,t,n,o,r){if(this.apiVersion="7.1",this.vaultUrl=t,this.clientId=e,this.clientSecret=n,this.tenantId=o,this.scope=r||"https://vault.azure.net/.default",!this.clientId||!this.clientSecret||!this.tenantId)throw new Error("Azure Key Vault client credentials are not fully configured. Please set Client ID, Client Secret, and Tenant ID.");this.accessToken=null}async getAuthToken(){if(this.accessToken)return this.accessToken;const e=`https://login.microsoftonline.com/${this.tenantId}/oauth2/v2.0/token`,t=new URLSearchParams({client_id:this.clientId,client_secret:this.clientSecret,scope:this.scope.endsWith("/.default")?this.scope:this.scope+"/.default",grant_type:"client_credentials"}),n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t}),o=await n.json();if(!o.access_token)throw new Error("Failed to get access token: "+JSON.stringify(o));return this.accessToken=o.access_token,this.accessToken}toSecretName(e){return e.replace(/_/g,"---").replace(/@/g,"--").replace(/\./g,"-")}async getSecret(e){const t=this.toSecretName(e),n=`${this.vaultUrl}/secrets/${t}?api-version=${this.apiVersion}`,o=await this.getAuthToken(),r=await fetch(n,{method:"GET",headers:{Authorization:`Bearer ${o}`}});if(!r.ok){const e=await r.json();throw new Error(`Error fetching secret: ${e.error.message}`)}return(await r.json()).value}async setSecret(e,t){const n=this.toSecretName(e),o=`${this.vaultUrl}/secrets/${n}?api-version=${this.apiVersion}`,r=await this.getAuthToken(),s=await fetch(o,{method:"PUT",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({value:t})});if(!s.ok){const e=await s.json();throw new Error(`Error setting secret: ${e.error.message}`)}}async listSecrets(){let e=[],t=`${this.vaultUrl}/secrets?api-version=${this.apiVersion}`;const n=await this.getAuthToken();for(;t;){const o=await fetch(t,{method:"GET",headers:{Authorization:`Bearer ${n}`}});if(!o.ok){const e=await o.json();throw new Error(`Error listing secrets: ${e.error.message}`)}const r=await o.json();e=e.concat(r.value),t=r.nextLink}return e}}},541:(e,t,n)=>{const o=n(329);e.exports=function(e,t){"use strict";const r=e.querySelector("[role=cred-status]"),s=e.querySelector("[role=auth-status]"),c=e.querySelector("[role=auth-login]"),i=e.querySelector("[role=connection-status]"),a=e.querySelector("[role=connection-status-text]"),l=e.querySelector("[role=grouping-rules-table] tbody"),u=l?l.querySelector("[role=template]"):null,d=e.querySelector("[role=accounts-list]"),g=e.querySelector("#vault-urls"),h=e.querySelector("[data-client-id]"),p=e.querySelector("[data-vault-url]");let y=e.querySelector(".preloader-overlay");y||(y=document.createElement("div"),y.className="preloader-overlay",y.style.display="none",y.style.position="fixed",y.style.top=0,y.style.left=0,y.style.width="100%",y.style.height="100%",y.style.background="rgba(255,255,255,0.8)",y.style.zIndex=9999,y.style.justifyContent="center",y.style.alignItems="center",y.style.textAlign="center",y.style.fontSize="1.5em",y.innerHTML='<div class="preloader-message"></div>',e.appendChild(y));const m=y.querySelector(".preloader-message");function f(e){m.textContent=e,y.style.display="flex"}function v(e=1e3){setTimeout(()=>{y.style.display="none"},e)}const S=new o(t),w=(e,t)=>{r.textContent=e,r.style.color=t?"red":"green",setTimeout(()=>r.textContent="",2e3)},b=(e,t)=>{i.style.color=e?"green":"red",a.textContent=t},q=async e=>{if(f("Connecting..."),!S.client||!S.client.clientId||!S.client.vaultUrl)return s.textContent="Configuration incomplete",c&&(c.style.display="inline-block"),b(!1,"Please configure Client ID and Vault URL."),f("Connection Failed: Configuration incomplete"),void v(2e3);try{const t=await S.client.getAuthToken(e);s.textContent=t?"Logged In":"Logged Out",c&&(c.style.display=t?"none":"inline-block"),t?(b(!0,"Authenticated"),f("Connection Success! You are connected. Syncing..."),v(1500)):(b(!1,"Authentication failed or token not received."),f("Connection Failed: No token received"),v(2e3))}catch(e){s.textContent="Logged Out",c&&(c.style.display="inline-block"),b(!1,`Authentication Failed: ${e.message}`),f(`Connection Failed: ${e.message}`),v(2500)}},k=(e=[])=>{d.innerHTML="",e.forEach(e=>{const t=document.createElement("li");t.textContent=e,d.appendChild(t)})};c&&c.addEventListener("click",()=>q(!0));const x=e.querySelector("[role=save-credentials]");x&&x.addEventListener("click",async()=>{const e=Array.from(l.querySelectorAll("tr")).map(e=>({name:e.querySelector("[role=group-name]").value,pattern:e.querySelector("[role=group-pattern]").value})).filter(e=>e.name&&e.pattern),o=await t.getOptionsAsync(),r=o.accounts,s=h.value,c=p.value;try{await t.saveOptions({...o,groupingRules:e,accounts:r,clientId:s,vaultUrl:c});const i=s||"d81f3ba2-ebf7-4d4c-8550-e642c3736d99";S.client=i&&c?new(n(345))(i,c):null,await S.loadOptions(),w("Settings saved successfully",!1)}catch(e){w(`Error saving settings: ${e.message}`,!0),b(!1,"Failed to save settings.")}});const C=e.querySelector("[role=sync-accounts]");C&&C.addEventListener("click",async()=>{w("Syncing accounts...",!1);try{if(!S.client||!S.client.clientId||!S.client.vaultUrl)return w("Configuration incomplete. Cannot sync accounts.",!0),void b(!1,"Configuration incomplete.");const e=await S.listAndGroupSecrets(),n=await t.getOptionsAsync();await t.saveOptions({...n,accounts:e,clientId:n.clientId||"d81f3ba2-ebf7-4d4c-8550-e642c3736d99",vaultUrl:n.vaultUrl}),k(Object.values(e).flat()),w("Sync complete!",!1),b(!0,"Connected")}catch(e){w(`Error syncing: ${e.message}`,!0),b(!1,"Sync Failed")}});const I=e.querySelector("[role=add-rule]");I&&I.addEventListener("click",()=>{const e=u.cloneNode(!0);e.querySelector("[role=group-name]").value="",e.querySelector("[role=group-pattern]").value="",e.querySelector("[role=remove-rule]").addEventListener("click",()=>e.remove()),l.appendChild(e)}),l&&u&&l.removeChild(u),(async()=>{const e=await t.getOptionsAsync();h&&(h.value=e.clientId||""),p&&(p.value=e.vaultUrl||"");const o=e.clientId||"d81f3ba2-ebf7-4d4c-8550-e642c3736d99",r=e.vaultUrl;S.client=o&&r?new(n(345))(o,r):null,((e=[])=>{l.innerHTML="",e.forEach(e=>{const t=u.cloneNode(!0);t.querySelector("[role=group-name]").value=e.name,t.querySelector("[role=group-pattern]").value=e.pattern,t.querySelector("[role=remove-rule]").addEventListener("click",()=>{t.remove()}),l.appendChild(t)})})(e.groupingRules),k(e.accounts),((e=[])=>{g.innerHTML="",e.forEach(e=>{const t=document.createElement("option");t.value=e,g.appendChild(t)})})(e.vaultUrls),q(!1)})()}},686:e=>{e.exports={addLog:function(e){const t={msg:e,ts:(new Date).toISOString()};chrome.storage.local.get(["bugMagnetLogs"],function(e){const n=e.bugMagnetLogs||[];n.push(t),chrome.storage.local.set({bugMagnetLogs:n})})},getLogs:function(e){chrome.storage.local.get(["bugMagnetLogs"],function(t){e(t.bugMagnetLogs||[])})},clearLogs:function(){chrome.storage.local.remove("bugMagnetLogs")}}},865:(e,t,n)=>{const o=n(329);e.exports=class{constructor(e){this.browserInterface=e,this.credentialManager=new o(e),this.rootId=null,this.menuIds=[]}async buildMenu(){"function"==typeof this.browserInterface.removeAllContextMenus?await this.browserInterface.removeAllContextMenus():(this.rootId&&await this.browserInterface.removeContextMenu(this.rootId),await Promise.all(this.menuIds.map(e=>this.browserInterface.removeContextMenu(e))),this.menuIds=[],this.rootId=null);const e=await this.browserInterface.getOptionsAsync(),t=e&&e.accounts,n=e&&e.debugLogging;if(n&&console.log("[BugMagnet] Loaded accounts for credential menu:",t),!t||0===Object.keys(t).length)return void(n&&console.log("[BugMagnet] No test accounts found in config."));this.rootId=this.browserInterface.createContextMenu({title:"Test Accounts",id:"test-accounts-root",contexts:["editable"]}),this.menuIds.push(this.rootId);let o=0;for(const e in t){const r=t[e];if(0===r.length)continue;const s="Ungrouped"===e?this.rootId:this.browserInterface.createContextMenu({title:e,parentId:this.rootId,id:`group-${e.replace(/\s/g,"-")}`,contexts:["editable"]});"Ungrouped"!==e&&this.menuIds.push(s),r.forEach(t=>{const r=this.browserInterface.createContextMenu({title:t,parentId:s,id:"test-account-"+o++,contexts:["editable"],onclick:(e,n)=>this.credentialManager.fillCredentials(n.id,t)});this.menuIds.push(r),n&&console.log(`[BugMagnet] Created test account menu: ${t} in ${e}`)})}}init(){this.buildMenu(),this.browserInterface.addStorageListener(()=>this.buildMenu())}}}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,n),s.exports}const o=n(259),r=n(288),s=n(541),c=n(686);document.addEventListener("DOMContentLoaded",function(){"use strict";const e=new o(chrome);new(n(865))(e).init(),r(document.getElementById("main"),e),s(document.getElementById("credentials"),e);const t=document.querySelector('button[role="test-page"]');t&&t.addEventListener("click",function(e){e.preventDefault(),window.open("testpage.html","_blank")});const i=document.querySelector('button[role="view-logs"]');i&&i.addEventListener("click",function(e){e.preventDefault(),c.getLogs(function(e){let t=e.map(e=>`[${e.ts}] ${e.msg}`).join("\n");t||(t="No logs."),window.open("","_blank","width=600,height=400").document.write("<pre>"+t.replace(/</g,"&lt;")+"</pre>")})})})})();